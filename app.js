const OverallForecast = {
  Date: "ประจำวันที่ 8 พฤษภาคม 2567 17.00 น. ",
  OverallDescriptionThai:
    "\tพยากรณ์อากาศ 24 ชั่วโมงข้างหน้า แนวพัดสอบของลมตะวันออกเฉียงใต้และลมใต้พัดปกคลุมภาคเหนือ และภาคกลางตอนบน ลักษณะเช่นนี้ทำให้บริเวณดังกล่าวมีฝนฟ้าคะนอง ลมกระโชกแรง และมีฝนตกหนักบางแห่ง ขอให้ประชาชนบริเวณภาคเหนือระวังอันตรายจากฝนฟ้าคะนอง ลมกระโชกแรง โดยหลีกเลี่ยงการอยู่ในที่โล่งแจ้ง ใต้ต้นไม้ใหญ่ สิ่งปลูกสร้าง และป้ายโฆษณาที่ไม่แข็งแรง สำหรับเกษตรกรควรเตรียมการป้องกันและระวังความเสียหายที่จะเกิดต่อผลผลิตทางการเกษตรและอันตรายต่อสัตว์เลี้ยงไว้ด้วย รวมทั้งระวังอันตรายจากฝนตกหนักและฝนที่ตกสะสมซึ่งอาจทำให้เกิดน้ำท่วมฉับพลัน และเพิ่มความระมัดระวังในการสัญจรผ่านบริเวณที่มีฝนฟ้าคะนองไว้ด้วย       สำหรับลมตะวันออกเฉียงใต้พัดปกคลุมทะเลอันดามัน ภาคใต้ และอ่าวไทย ทำให้ภาคใต้มีฝนฟ้าคะนองบางแห่ง ส่วนชาวเรือควรหลีกเลี่ยงการเดินเรือในบริเวณที่มีฝนฟ้าคะนองไว้ด้วย ฝุ่นละอองในระยะนี้: ภาคเหนือมีการสะสมของฝุ่นละออง/หมอกควันอยู่ในเกณฑ์ปานกลางถึงค่อนข้างสูง เนื่องจากลมที่พัดปกคลุมมีกำลังอ่อน และการระบายอากาศในบริเวณดังกล่าวอยู่ในเกณฑ์ที่ไม่ดี สำหรับภาคตะวันออกเฉียงเหนือ และภาคกลาง รวมทั้งกรุงเทพมหานครและปริมณฑลมีการสะสมของฝุ่นละออง/หมอกควันลดลงเนื่องจากมีฝนเพิ่มมากขึ้น",
  OverallDescriptionEnglish:
    "\tThe confluence of southeasterly and southerly winds occurs over the North and the upper Central thundershowers witih gust and isolated heavy rains in the areas. People in the North should stay safe from severe weather conditions by keeping off outdoor places, large trees and unsecured buildings and should beware of the heavy rain and accumulated rain that may be flashing floods overflows. \tAll transports take more caution during the phenomena. Farmers should prevent for crops damage and animals danger.\tThe southeasterly winds prevail over the Andaman Sea, the South and the Gulf with isolated thundershowers. All ships should proceed with caution and keep off thundershowers.",
  RegionForecast: [
    {
      RegionNameThai: "ภาคเหนือ",
      DescriptionThai:
        "อากาศร้อนกับมีฟ้าหลัวในตอนกลางวัน และมีอากาศร้อนจัดบางพื้นที่ โดยมีฝนฟ้าคะนอง ร้อยละ 40 ของพื้นที่ กับมีลมกระโชกแรง และมีฝนตกหนักบางแห่งบริเวณจังหวัดเชียงใหม่ เชียงราย ลำพูน พะเยา น่าน แพร่ อุตรดิตถ์ ตาก พิจิตร พิษณุโลก และเพชรบูรณ์ อุณหภูมิต่ำสุด 22-26 องศาเซลเซียส อุณหภูมิสูงสุด 35-40 องศาเซลเซียส ลมใต้ ความเร็ว 5-15 กม./ชม.",
      RegionNameEnglish: "North",
      DescriptionEnglish:
        "Day hot with haze. Isolated very hot. Scattered thundershowers with gusty wind and isolated heavy rains in Chiang Mai, Chiang Rai, Lamphun, Phayao, Nan, Phrae, Uttaradit, Tak, Phichit, Phitsanulok and Phetchabun.Minimum temperature 22-26 °C.  Maximum temperature 35-40 °C. Southerly winds 5-15 km/hr.",
    },
    {
      RegionNameThai: "ภาคตะวันออกเฉียงเหนือ",
      DescriptionThai:
        "อากาศร้อนในตอนกลางวัน โดยมีฝนฟ้าคะนอง ร้อยละ 40 ของพื้นที่ ส่วนมากบริเวณจังหวัดเลย หนองคาย บึงกาฬ หนองบัวลำภู อุดรธานี สกลนคร ชัยภูมิ ขอนแก่น มหาสารคาม กาฬสินธ์ ร้อยเอ็ด นครราชสีมา บุรีรัมย์ และสุรินทร์อุณหภูมิต่ำสุด 24-27 องศาเซลเซียส อุณหภูมิสูงสุด 37-39 องศาเซลเซียส ลมตะวันออกเฉียงใต้ ความเร็ว 10-20 กม./ชม.",
      RegionNameEnglish: "North East",
      DescriptionEnglish:
        "Day hot. Scattered thundershowers mostly in Loei, Nong Khai, Bueng Kan, Nong Bua Lamphu, Udon Thani, Sakon Nakhon, Chaiyaphum, Khon Kaen, Maha Sarakham, Kalasin, Roi Et, Nakhon Ratchasima, Buriram and Surin.Minimum temperature 24-27 °C. Maximum temperature 37-39 °C.  Southeasterly winds 10-20 km/hr.",
    },
    {
      RegionNameThai: "ภาคกลาง",
      DescriptionThai:
        "อากาศร้อนในตอนกลางวัน และมีอากาศร้อนจัดบางพื้นที่ โดยมีฝนฟ้าคะนอง ร้อยละ 40 ของพื้นที่ กับมีลมกระโชกแรง และมีฝนตกหนักบางแห่งบริเวณจังหวัดนครสวรรค์ อุทัยธานี ชัยนาท ลพบุรี และกาญจนบุรี อุณหภูมิต่ำสุด 24-26 องศาเซลเซียส อุณหภูมิสูงสุด 38-40 องศาเซลเซียส ลมใต้ ความเร็ว 10-20 กม./ชม.",
      RegionNameEnglish: "Central",
      DescriptionEnglish:
        "Day hot. Isolated very hot. Scattered thundershowers with gusty wind and isolated heavy rains in Nakhon Sawan, Uthai Thani, Chainat, Lopburi and Kanchanaburi.Minimum temperature 24-26 °C. Maximum temperature 38-40 °C. Southerly winds 10-20 km/hr.",
    },
    {
      RegionNameThai: "ภาคตะวันออก",
      DescriptionThai:
        "มีฝนฟ้าคะนอง ร้อยละ 40 ของพื้นที่ และมีฝนตกหนักบางแห่ง บริเวณจังหวัดนครนายก ฉะเชิงเทรา ชลบุรี ระยอง จันทบุรี และตราดอุณหภูมิต่ำสุด 24-27 องศาเซลเซียส อุณหภูมิสูงสุด 36-38 องศาเซลเซียส ลมตะวันออกเฉียงใต้ ความเร็ว 10-30 กม./ชม. ทะเลมีคลื่นต่ำกว่า 1 เมตร บริเวณที่มีฝนฟ้าคะนองคลื่นสูงมากกว่า 1 เมตร ",
      RegionNameEnglish: "East",
      DescriptionEnglish:
        "Scattered thundershowers and isolated heavy rains in Nakhon Nayok, Chachoengsao, Chonburi, Rayong, Chanthaburi and Trat. Minimum temperature 24-27 °C. Maximum temperature 36-38 °C. Southeasterly winds 10-30 km/hr. Wave below 1 meter and above 1 meter high in thundershowers.",
    },
    {
      RegionNameThai: "ภาคใต้ฝั่งตะวันออก",
      DescriptionThai:
        "อากาศร้อนในตอนกลางวัน โดยมีฝนฟ้าคะนอง ร้อยละ 40 ของพื้นที่ ส่วนมากบริเวณจังหวัดประจวบคีรีขันธ์ ชุมพร สุราษฎร์ธานี นครศรีธรรมราช พัทลุง และสงขลาอุณหภูมิต่ำสุด 23-25 องศาเซลเซียส อุณหภูมิสูงสุด 35-39 องศาเซลเซียสลมตะวันออกเฉียงใต้ ความเร็ว 10-30 กม./ชม.ทะเลมีคลื่นต่ำกว่า 1 เมตร บริเวณที่มีฝนฟ้าคะนองคลื่นสูงมากกว่า 1 เมตร",
      RegionNameEnglish: "South East Coast",
      DescriptionEnglish:
        "Day hot. Scattered thundershowers mostly in Prachuap Khiri Khan, Chumphon, Surat Thani, Nakhon Si Thammarat, Phatthalung and Songkhla.Minimum temperature 23-25 °C. Maximum temperature 35-39 °C.Southeasterly winds 10-30 km/hr.Wave below 1 meter and above 1 meter high in thundershowers.",
    },
    {
      RegionNameThai: "ภาคใต้ฝั่งตะวันตก",
      DescriptionThai:
        "มีฝนฟ้าคะนอง ร้อยละ 40 ของพื้นที่ ส่วนมากบริเวณจังหวัดระนอง พังงา ภูเก็ต กระบี่ และตรัง อุณหภูมิต่ำสุด 24-26 องศาเซลเซียส อุณหภูมิสูงสุด 36-37 องศาเซลเซียสลมตะวันออกเฉียงใต้ ความเร็ว 10-30 กม./ชม. ทะเลมีคลื่นต่ำกว่า 1 เมตร บริเวณที่มีฝนฟ้าคะนองคลื่นสูงมากกว่า 1 เมตร",
      RegionNameEnglish: "South West Coast",
      DescriptionEnglish:
        "Scattered thundershowers mostly in Ranong, Phang Nga, Phuket, Krabi and Trang.Minimum temperature 24-26 °C. Maximum temperature 36-37 °C.Southeasterly winds 10-30 km/hr. Wave below 1 meter and above 1 meter high in thundershowers.",
    },
    {
      RegionNameThai: "กรุงเทพและปริมณฑล",
      DescriptionThai:
        "มีฝนฟ้าคะนอง ร้อยละ 30 ของพื้นที่ อุณหภูมิต่ำสุด 25-27 องศาเซลเซียส อุณหภูมิสูงสุด 36-38 องศาเซลเซียส ลมตะวันออกเฉียงใต้ ความเร็ว 10-30 กม./ชม. ",
      RegionNameEnglish: "Bangkok and Perimeters",
      DescriptionEnglish:
        "Isolated thundershowers.Minimum temperature 25-27 °C. Maximum temperature 36-38 °C. Southeasterly  winds 10-30 km/hr.",
    },
  ],
};

document.addEventListener("DOMContentLoaded", function () {
  const wetherSummary = () => {
    document.getElementById("forecast-date").innerText = OverallForecast.Date;
    document.getElementById("overall-description-thai").innerText =
      OverallForecast.OverallDescriptionThai;

    const regionForecastTable = document.getElementById("region-forecast");
    OverallForecast.RegionForecast.forEach((region) => {
      const row = document.createElement("tr");
      row.innerHTML = `<td>${region.RegionNameThai}</td><td>${region.DescriptionThai}</td>`;
      regionForecastTable.appendChild(row);
    });
  };

  const fetchForecastData = async () => {
    const headers = {
      accept: "application/json",
      authorization: "Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImp0aSI6ImY5MzUyMzg5ZDYzMWQ3MDRiNWFjZjBiNmEyMmY0MGM5MzNhNzAyNTdjMjZkYjkzZGFkOTdiYThmYzEzYmI0OGE5ODAxN2ZjMzgwZTJjMjZmIn0.eyJhdWQiOiIyIiwianRpIjoiZjkzNTIzODlkNjMxZDcwNGI1YWNmMGI2YTIyZjQwYzkzM2E3MDI1N2MyNmRiOTNkYWQ5N2JhOGZjMTNiYjQ4YTk4MDE3ZmMzODBlMmMyNmYiLCJpYXQiOjE3MTU0MTIyNDgsIm5iZiI6MTcxNTQxMjI0OCwiZXhwIjoxNzQ2OTQ4MjQ4LCJzdWIiOiIzMTkwIiwic2NvcGVzIjpbXX0.d6JlRmkei0rmLiZEUPP84iVhAC9m21eVxOFFnT5QFK9CqxE3PSvl8NUERVf7RuN18zuSVfY4ZndrJMmnzt5JCScaZ0Q5vZCeT0CIOZjStHf-eulPEW2vtSThNJX5SdbChPl-AMtnboyZpZix6o34oCHx8gAMRxMSrBkZjm8Kh2F4KgzXj1uNIOoF_Jh2kiybgfN3Av3cjuqNWohZV0EB7l8glMBRqcUEMGhm5B_rwnt4oUJxPVeiEVQ0G5dAS37qW3E9VnqtTF5OtKGcNIMRmcF6A2zuVSDzI5TDB2uySWlEFxepbDkD5BlLvkTzKjpgJ2CZ0LUfthUvoexnael6B0Shi8xgx07jxzCwDpOTKrHCWd4W0LrQCLYw1NSzNhYzkFOjRPHafHCRc_glwOtWpVX0Rrvmc0aggLEPBiBL9hpJMbhQl33G5bcj3AcBjHO8arPo6UG-pTEGGYU2WNA9z9i3SQNwRhzNwo0qC49A3YIXRkQwhJC3kwb5zKZc-XTwx-EpN18hEL3lZZ3Rs0vUk9mpZ_pXGh7D75gbJxAURSzCwB1kjlVyKzJf9yzHkYJuskplbw2-obTSYw-Ra12QK8VKAHjbfpjUSQ98Qmo9uG-cFwYzq38ce7hmP9_TdaTpdE_IrbvuhVv2bAo75ewn1v8rfJPXI6HRYLz2HvePrs4",
    }
    const response = await fetch("https://data.tmd.go.th/nwpapi/v1/forecast/location/daily/place?province=สมุทรปราการ&amphoe=พระประแดง&tambon=สำโรงใต้&fields=tc_max,rh,rh,slp,psfc,rain,ws10m,wd10m,cloudlow,cloudmed,cloudhigh,swdown,cond&date=2024-05-11&duration=7", { headers });
    console.log('response', response);
    const data = await response.json();
    return data;
  };

  const fetchForecastData7 = async () => {

    const headers = {
      'Access-Control-Allow-Origin': '*',
    }
   
    // const response = await fetch("https://data.tmd.go.th/api/WeatherForecast7Days/v2/?uid=api&ukey=api12345&format=json");
    const response = await fetch("https://cors-anywhere.herokuapp.com/https://data.tmd.go.th/api/WeatherForecast7Days/v2/?uid=api&ukey=api12345&format=json", { headers });
    console.log('response', response);
    const data = await response.json();
    return data;
  };

  async function fetchAndInitializeWeatherData() {
    const response = await fetch("data.json");
    const rawWeatherData = await response.json();
    const formattedWeatherData = formatWeatherData(rawWeatherData);

    populateProvinceDropdown(formattedWeatherData);
    document
      .getElementById("province-select")
      .addEventListener("change", () => {
        updateForecast(formattedWeatherData);
      });
    updateForecast(formattedWeatherData);
  }
  const convertDegreesToArrow = (degrees) => {
    if (degrees >= 337.5 || degrees < 22.5) return "↑"; // North
    else if (degrees >= 22.5 && degrees < 67.5) return "↗"; // Northeast
    else if (degrees >= 67.5 && degrees < 112.5) return "→"; // East
    else if (degrees >= 112.5 && degrees < 157.5) return "↘"; // Southeast
    else if (degrees >= 157.5 && degrees < 202.5) return "↓"; // South
    else if (degrees >= 202.5 && degrees < 247.5) return "↙"; // Southwest
    else if (degrees >= 247.5 && degrees < 292.5) return "←"; // West
    else if (degrees >= 292.5 && degrees < 337.5) return "↖"; // Northwest
  };

  function formatWeatherData(rawData) {
    const formattedData = {};
    rawData.Provinces.Province.forEach((province) => {
      const forecastData = province.SevenDaysForecast.ForecastDate.map(
        (date, index) => ({
          date,
          maxTemp: province.SevenDaysForecast.MaximumTemperature[index],
          minTemp: province.SevenDaysForecast.MinimumTemperature[index],
          windSpeed: province.SevenDaysForecast.WindSpeed[index],
          rainCover: province.SevenDaysForecast.PercentRainCover[index],
          description: province.SevenDaysForecast.DescriptionThai[index],
          windDirection: province.SevenDaysForecast.WindDirection[index],
          temperatureThai: province.SevenDaysForecast.TemperatureThai[index],
          temperatureEnglish:
            province.SevenDaysForecast.TemperatureEnglish[index],
        })
      );

      //   forecastData.sort((a, b) => new Date(a.date) - new Date(b.date));

      formattedData[province.ProvinceNameThai] = forecastData.reverse();
    });

    return formattedData;
  }

  function populateProvinceDropdown(weatherData) {
    const provinceSelect = document.getElementById("province-select");
    for (const province in weatherData) {
      const option = document.createElement("option");
      option.value = province;
      option.textContent = province;
      provinceSelect.appendChild(option);
    }
  }

  function updateForecast(weatherData) {
    const province = document.getElementById("province-select").value;
    const data = weatherData[province] || [];
    const tableBody = document
      .getElementById("forecast-table")
      .querySelector("tbody");

    tableBody.innerHTML = "";

    console.log(data);

    data.forEach((entry) => {
      const row = tableBody.insertRow();
      row.insertCell(0).textContent = entry.date;
      row.insertCell(1).textContent = entry.rainCover;
      row.insertCell(2).textContent = entry.description;
      row.insertCell(3).textContent = entry.maxTemp;
      row.insertCell(4).textContent = entry.minTemp;
      //   row.insertCell(5).textContent = "";
      //   row.insertCell(6).textContent = entry.windSpeed;
      row.insertCell(5).textContent = `${convertDegreesToArrow(
        entry.windDirection
      )} ${entry.windSpeed} กม./ชม. `;
    });
  }

  wetherSummary();
  fetchAndInitializeWeatherData();
  fetchForecastData();
  fetchForecastData7();
});
